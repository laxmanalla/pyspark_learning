<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SQL Topics</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUa6mY5J2+0p2K2cKkW0v5Q1K/6m1Zl7rG6z4l5s1Y5V6e6s3G9bZ6v7o9mM" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
      :root{--bg:#f6f8fa;--card-bg:#ffffff;--muted:#6c757d}
      body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; margin:0; background:linear-gradient(180deg,#f6f8fa,#ffffff); color:#222}
      .container{max-width:1100px; margin:28px auto;}
      header .title {font-weight:700; letter-spacing:0.2px}
      .card-custom{background:var(--card-bg); border-radius:12px; padding:20px; margin-bottom:16px; box-shadow:0 6px 20px rgba(16,24,40,0.06); border:1px solid rgba(16,24,40,0.04)}
      .card-custom h3{margin:0 0 8px 0;font-size:1.15rem}
      .label{font-weight:700;color:#343a40;margin-right:8px}
      .muted{color:var(--muted)}
      .example em{font-style:italic;color:#333}
      .card-custom blockquote{background:#f1f3f5;border-left:4px solid rgba(0,0,0,0.06);padding:12px 14px;margin:12px 0;border-radius:8px}
      .card-custom blockquote p{margin:0 0 6px 0;color:#333}
      .yaml-note{font-size:0.95rem;color:var(--muted); background:transparent}
      .top-controls .btn{border-radius:10px}
      @media (max-width:720px){.container{padding:0 12px}}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="d-flex align-items-center justify-content-between mb-4">
        <div>
          <h1 class="title h4 mb-0">SQL Topics</h1>
          <!-- <div class="yaml-note">Rendered from <code>sql.yaml</code></div> -->
        </div>
        <!-- <div class="top-controls">
          <label class="btn btn-light d-inline-flex align-items-center gap-2">
            <input id="file-input" type="file" accept=".yml,.yaml" style="display:none">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-upload" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 0 .5.1h3v4a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-4h3a.5.5 0 0 0 .5-.1c.1-.1.1-.3 0-.4L8.7 2.3a1 1 0 0 0-1.4 0L.5 9.5c-.1.1-.1.3 0 .4z"/></svg>
            Load YAML
          </label>
        </div> -->
      </div>

      <main id="content">
        <div class="muted">Loading topics from <code>sql.yaml</code>...</div>
      </main>
    </div>

    <script>
      const content = document.getElementById('content');
      const fileInput = document.getElementById('file-input');

      function renderTopics(obj){
        content.innerHTML = ''; // clear
        if (!obj || typeof obj !== 'object'){
          content.innerHTML = '<div class="muted">No topics found in YAML.</div>';
          return;
        }
        // iterate keys in order
        const entries = Object.keys(obj).map(k=>({key:k, val: obj[k]}));
        if (entries.length === 0){
          content.innerHTML = '<div class="muted">No topics found in YAML.</div>';
          return;
        }

        entries.forEach(item => {
          const data = item.val || {};
          const topic = data.Topic || '';
          const desc = data.Description || '';
          const example = data.real_world_example || data['real_world_example'] || '';
          const extra = data.extra_content || '';

          const card = document.createElement('article');
          card.className = 'card-custom';

          const h3 = document.createElement('h3');
          const labelTopic = document.createElement('span');
          labelTopic.className = 'label';
          labelTopic.textContent = 'Topic Name:';
          h3.appendChild(labelTopic);
          h3.appendChild(document.createTextNode(' ' + topic));

          const pDesc = document.createElement('p');
          pDesc.className = '';
          const labelDesc = document.createElement('span');
          labelDesc.className = 'label';
          labelDesc.textContent = 'Description:';
          const descSpan = document.createElement('span');
          descSpan.textContent = ' ' + desc;
          pDesc.appendChild(labelDesc);
          pDesc.appendChild(descSpan);

          const pExample = document.createElement('p');
          pExample.className = 'example';
          const labelEx = document.createElement('span');
          labelEx.className = 'label';
          labelEx.textContent = 'Real world example:';
          const em = document.createElement('em');
          em.textContent = example;
          pExample.appendChild(labelEx);
          pExample.appendChild(document.createTextNode(' '));
          pExample.appendChild(em);

          // optional example + explanation block (render as blockquote when present)
          const exampleText = data.example || '';
          const exampleExplanation = data.example_explanation || data.exampleExplanation || '';
          let blockquoteEl = null;
          if (exampleText && String(exampleText).trim().length > 0){
            blockquoteEl = document.createElement('blockquote');
            blockquoteEl.className = 'blockquote mt-3';
            // split example text into lines and render each as its own paragraph
            const lines = String(exampleText).split(/\r?\n/);
            lines.forEach((ln)=>{
              const lineP = document.createElement('p');
              lineP.className = 'mb-1';
              lineP.textContent = ln;
              blockquoteEl.appendChild(lineP);
            });
            if (exampleExplanation && String(exampleExplanation).trim().length > 0){
              const footer = document.createElement('footer');
              footer.className = 'blockquote-footer';
              footer.textContent = exampleExplanation;
              blockquoteEl.appendChild(footer);
            }

            // (example heading removed â€” rendering only the blockquote)
          }


          // append core sections
          card.appendChild(h3);
          card.appendChild(pDesc);
          card.appendChild(pExample);

          // only show extra content when present
          if (extra && String(extra).trim().length > 0){
            const pExtra = document.createElement('p');
            pExtra.className = 'muted';
            const labelExtra = document.createElement('span');
            labelExtra.className = 'label';
            labelExtra.textContent = 'Extra content:';
            const extraSpan = document.createElement('span');
            extraSpan.textContent = ' ' + extra;
            pExtra.appendChild(labelExtra);
            pExtra.appendChild(extraSpan);
            card.appendChild(pExtra);
          }

          // append optional blockquote after other content
          if (blockquoteEl) card.appendChild(blockquoteEl);

          content.appendChild(card);
        });
      }

      // Try to fetch default yaml file first
      fetch('sql.yaml')
        .then(r => r.ok ? r.text() : Promise.reject('not found'))
        .then(t => {
          try{
            const parsed = jsyaml.load(t);
            renderTopics(parsed);
          }catch(e){
            content.innerHTML = '<div class="muted">Failed to parse YAML: ' + (e.message||e) + '</div>';
          }
        }).catch(err => {
          content.innerHTML = '<div class="muted">Could not load <code>sql.yaml</code> from workspace. You can upload a YAML file using the Load YAML button.</div>';
        });

      // allow user to upload YAML file manually
      fileInput.addEventListener('change', (ev)=>{
        const f = ev.target.files && ev.target.files[0];
        if (!f) return;
        const reader = new FileReader();
        reader.onload = ()=>{
          try{
            const parsed = jsyaml.load(reader.result);
            renderTopics(parsed);
          }catch(e){
            content.innerHTML = '<div class="muted">Failed to parse uploaded YAML: ' + (e.message||e) + '</div>';
          }
        };
        reader.readAsText(f);
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoYz1H6Zb6Y9z1qQZ6b9Y5o1b6Qw5nQv5K5Y6q2mZ4Y5b3E" crossorigin="anonymous"></script>
  </body>
</html>
